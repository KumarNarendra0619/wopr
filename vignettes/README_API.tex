\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage[]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\PassOptionsToPackage{hyphens}{url} % url is loaded by hyperref
\usepackage[unicode=true]{hyperref}
\hypersetup{
            pdftitle={An overview of the WOPR API for developers},
            pdfauthor={Doug Leasure and Maksym Bondarenko},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

% set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother


\title{An overview of the WOPR API for developers}
\author{Doug Leasure and Maksym Bondarenko}
\date{}

\begin{document}
\maketitle

WorldPop Research Group\\
University of Southampton

13 February 2020

\subsection{Introduction}\label{introduction}

The WOPR REST API provides a way for web servers and other computers to
communicate with the \href{https://wopr.worldpop.org}{WorldPop Open
Population Repository} to submit requests for data and to retrieve
results. This can be used to:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Automate the process of downloading the latest WorldPop population
  data sets and documentation,
\item
  Submit spatial queries (points or polygons) to the WorldPop server to
  retrieve population estimates within user-defined geographic areas,
\item
  Get estimates of population sizes for specific demographic groups
  (i.e.~age and sex), and
\item
  Get probabilistic estimates of uncertainty for all population
  estimates.
\end{enumerate}

This document provides instructions how to utilize each of the following
API endpoints:

\textbf{Data Catalogue}\\
\url{https://wopr.worldpop.org/api/v1.0/data}

\textbf{Spatial Queries}\\
\url{https://api.worldpop.org/v1/wopr/pointtotal}\\
\url{https://api.worldpop.org/v1/wopr/pointagesex}\\
\url{https://api.worldpop.org/v1/wopr/polytotal}\\
\url{https://api.worldpop.org/v1/wopr/polyagesex}

\textbf{Retrieve Results}\\
\url{https://api.worldpop.org/v1/tasks}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\subsection{Data Download}\label{data-download}

\textbf{API Endpoint:}\\
\url{https://wopr.worldpop.org/api/v1.0/data}\\

This API endpoint will return the WOPR data catalogue in JSON format.
The JSON is organized with the following hierarchical levels:

\textbf{country} A three letter code to identify the country that the
dataset represents. WOPR uses
\href{https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3}{ISO country
codes} to abbreviate country names. For example
\texttt{\textquotesingle{}NGA\textquotesingle{}} regers to Nigeria.

\textbf{category} The category describes the types of data available for
a given country. For example,
\texttt{\textquotesingle{}Population\textquotesingle{}} refers to
population estimates.

\textbf{version} The version of a data release for a given country and
data type. For example,
\texttt{\textquotesingle{}v1.2\textquotesingle{}}.

\textbf{file\_type} The file\_type describes the category of individual
files. For example, \texttt{\textquotesingle{}gridded\textquotesingle{}}
refers to gridded population estimates, and
\texttt{\textquotesingle{}sql\textquotesingle{}} refers to the SQL
database used on the WOPR backend to support the spatial queries
described below.\\

Each file has the following attributes:

\textbf{title} is a short descriptive name of the data set.

\textbf{desc} is a longer description of the data set.

\textbf{citation} is the recommended citation.

\textbf{doi} is the official published DOI (digital object identifier)
that can be used for citations. The DOI refers to a stable and permanent
version of the file that is stored at
\url{ftp://ftp.worldpop.org/repo/wopr}. These files may differ slightly
from the files stored at
\href{https://wopr.worldpop.org}{wopr.worldpop.org} if minor changes
were made since the time of the DOI publication.

\textbf{file} is the file name.

\textbf{file\_size} is the size of the file on the hard disk (MB).

\textbf{url} is the URL for downloading the file.

\textbf{date} is the date the file was released.

\textbf{hash} is the MD5 hash that can be used to compare files to
ensure their contents are identical.

\textbf{git} is the URL for the GitHub repository containing code that
is relevant to the data set (e.g.~the code used to create the data).\\

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\subsection{Spatial Queries}\label{spatial-queries}

Spatial queries can be submitted to WOPR as points or polygon locations
in a GeoJSON format using several different WOPR API endpoints that will
be described below. Spatial requests are supported for any data releases
in the category \texttt{\textquotesingle{}Population\textquotesingle{}}
that contain an SQL database
\texttt{file\_type=\textquotesingle{}sql\textquotesingle{}} (see Data
Download above).

Before describing the API endpoints, a note about the format of the
results. WOPR will return population estimates for the queried location
and demographic group as a JSON that contains a vector of numbers
representing the population estimate for a given location:
\texttt{122,88,108,119,98,92,98,101,121,103,127,122,103,118,...}. A
histogram of these numbers will graphically illustrate the population
estimate and its uncertainty as a probability distribution:

\includegraphics{README_API_files/figure-latex/unnamed-chunk-1-1.pdf}

The most likely population estimate is the mean of this distribution
(e.g.~100 people, in this case).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   64.00   93.00  100.00   99.97  107.00  135.00
\end{verbatim}

The 95\% confidence intervals for the population estimate can be
calculated as the 0.025 and 0.975 quantiles:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{quantile}\NormalTok{(x, }\DataTypeTok{probs=}\KeywordTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{, }\FloatTok{0.975}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  2.5% 97.5% 
##    81   120
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\subsection{Point-based total
population}\label{point-based-total-population}

\textbf{API Endpoint:}\\
\url{https://api.worldpop.org/v1/wopr/pointtotal}\\

This endpoint accepts coordinates for a point location and returns the
total population. Requests to this API endpoint require the following
arguments:

\textbf{iso3} The
\href{https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3}{ISO country
code} of the country to query (e.g. \texttt{NGA}).

\textbf{ver} The version of the population estimates to query (e.g.
\texttt{1.2}).

\textbf{lat} The latitude of the location to query using the WGS84
coordinate system (e.g. \texttt{11.53579}).

\textbf{lon} The longitude of the location to query using the WGS84
coordinate system (e.g. \texttt{4.850808}).\\

An example of an API request:\\
\url{https://api.worldpop.org/v1/wopr/pointtotal?iso3=NGA\&ver=1.2\&lat=11.53579\&lon=4.850808}\\

This request returns a task identification number
\texttt{2a6a2883-3fd7-5fbf-832c-86e5f35e7c5e} that can be used to query
the result:\\
\url{https://api.worldpop.org/v1/tasks/2a6a2883-3fd7-5fbf-832c-86e5f35e7c5e}\\

Results for any task id from WOPR can be retrieved in this way,
regardless of the endpoint used to submit the request.\\

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\subsection{Point-based population for specific age-sex
group}\label{point-based-population-for-specific-age-sex-group}

\textbf{API Endpoint:}\\
\url{https://api.worldpop.org/v1/wopr/pointagesex}\\

This endpoint accepts coordinates for a point location and returns the
population size for a specified age-sex group. Requests to this API
endpoint require the following arguments:

\textbf{iso3} The
\href{https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3}{ISO country
code} of the country to query (e.g. \texttt{NGA}).

\textbf{ver} The version of the population estimates to query (e.g.
\texttt{1.2}).

\textbf{lat} The latitude of the location to query using the WGS84
coordinate system (e.g. \texttt{11.53579}).

\textbf{lon} The longitude of the location to query using the WGS84
coordinate system (e.g. \texttt{4.850808}).

\textbf{agesex} The age-sex groups for which a population estimate is
required. This argument accepts a comma-separated vector of age-sex
group identifiers. \texttt{f0} represents females less than one year
old; \texttt{f1} represents females from age one to four; \texttt{f5}
represents females from five to nine; \texttt{f10} represents females
from 10 to 14; and so on. \texttt{m0} represents males less than one,
etc. The full list of acceptable values:
\texttt{m0,\ m1,\ m5,\ m10,\ m15,\ m20,\ m25,\ m30,\ m35,\ m40,\ m45,\ m50,\ m55,\ m60,\ m65,\ m70,\ m75,\ m80,\ f0,\ f1,\ f5,\ f10,\ f15,\ f20,\ f25,\ f30,\ f35,\ f40,\ f45,\ f50,\ f55,\ f60,\ f65,\ f70,\ f75,\ f80}.\\

An example of an API request:\\
\url{https://api.worldpop.org/v1/wopr/pointagesex?iso3=NGA\&ver=1.2\&lat=11.53579\&lon=4.850808\&agesex=m0,m1,f0,f1}\\

This request will return the population of children under five at the
specified point location. The task id was
\texttt{38f18d6e-d7d8-5886-828a-45c29da7f766}. This can be used to
retrieve the result:\\
\url{https://api.worldpop.org/v1/tasks/38f18d6e-d7d8-5886-828a-45c29da7f766}\\

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\subsection{Polygon-based total
population}\label{polygon-based-total-population}

\textbf{API Endpoint:}\\
\url{https://api.worldpop.org/v1/wopr/polytotal}\\

This endpoint accepts a GeoJSON representing a polygon location and
returns the total population. Requests to this API endpoint require the
following arguments:

\textbf{iso3} The
\href{https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3}{ISO country
code} of the country to query (e.g. \texttt{NGA}).

\textbf{ver} The version of the population estimates to query (e.g.
\texttt{1.2}).

\textbf{geojson} A GeoJSON representing the polygon location to query
(see example below).

\begin{verbatim}
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              3.2080078125,
              7.0027636819827475
            ],
            [
              3.7902832031250004,
              7.0027636819827475
            ],
            [
              3.7902832031250004,
              7.612997502224103
            ],
            [
              3.2080078125,
              7.612997502224103
            ],
            [
              3.2080078125,
              7.0027636819827475
            ]
          ]
        ]
      }
    }
  ]
}
\end{verbatim}

An example of an API request:\\
\href{https://api.worldpop.org/v1/wopr/polytotal?iso3=NGA\&ver=1.2\&geojson=\%7B\%22type\%22:\%22FeatureCollection\%22,\%22features\%22:\%5B\%7B\%22type\%22:\%22Feature\%22,\%22properties\%22:\%7B\%7D,\%22geometry\%22:\%7B\%22type\%22:\%22Polygon\%22,\%22coordinates\%22:\%5B\%5B\%5B3.2080078125,7.0027636819827475\%5D,\%5B3.7902832031250004,7.0027636819827475\%5D,\%5B3.7902832031250004,7.612997502224103\%5D,\%5B3.2080078125,7.612997502224103\%5D,\%5B3.2080078125,7.0027636819827475\%5D\%5D\%5D\%7D\%7D\%5D\%7D}{https://api.worldpop.org/v1/wopr/polytotal?iso3=NGA\&ver=1.2\&geojson=\{``type'':``FeatureCollection'',``features'':{[}\{``type'':``Feature'',``properties'':\{\},``geometry'':\{``type'':``Polygon'',``coordinates'':{[}{[}{[}3.2080078125,7.0027636819827475{]},{[}3.7902832031250004,7.0027636819827475{]},{[}3.7902832031250004,7.612997502224103{]},{[}3.2080078125,7.612997502224103{]},{[}3.2080078125,7.0027636819827475{]}{]}{]}\}\}{]}\}}\\

This request returns a task identification number
\texttt{06b50b9f-d94d-50b9-916a-1d34b767d00a} that can be used to query
the result:\\
\url{https://api.worldpop.org/v1/tasks/06b50b9f-d94d-50b9-916a-1d34b767d00a}\\

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\subsection{Polygon-based population for specific age-sex
group}\label{polygon-based-population-for-specific-age-sex-group}

\textbf{API Endpoint:}\\
\url{https://api.worldpop.org/v1/wopr/polyagesex}\\

This endpoint accepts a GeoJSON representing a polygon location and
returns the population size within a specified age-sex group. Requests
to this API endpoint require the following arguments:

\textbf{iso3} The
\href{https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3}{ISO country
code} of the country to query (e.g. \texttt{NGA}).

\textbf{ver} The version of the population estimates to query (e.g.
\texttt{1.2}).

\textbf{geojson} A GeoJSON representing the polygon location to query
(see example above).

\textbf{agesex} The age-sex groups for which a population estimate is
required. This argument accepts a comma-separated vector of age-sex
group identifiers. The full list of acceptable values:
\texttt{m0,\ m1,\ m5,\ m10,\ m15,\ m20,\ m25,\ m30,\ m35,\ m40,\ m45,\ m50,\ m55,\ m60,\ m65,\ m70,\ m75,\ m80,\ f0,\ f1,\ f5,\ f10,\ f15,\ f20,\ f25,\ f30,\ f35,\ f40,\ f45,\ f50,\ f55,\ f60,\ f65,\ f70,\ f75,\ f80}.\\

An example of an API request:\\
\href{https://api.worldpop.org/v1/wopr/polyagesex?iso3=NGA\&ver=1.2\&agesex=m0,m1,f0,f1\&geojson=\%7B\%22type\%22:\%22FeatureCollection\%22,\%22features\%22:\%5B\%7B\%22type\%22:\%22Feature\%22,\%22properties\%22:\%7B\%7D,\%22geometry\%22:\%7B\%22type\%22:\%22Polygon\%22,\%22coordinates\%22:\%5B\%5B\%5B3.2080078125,7.0027636819827475\%5D,\%5B3.7902832031250004,7.0027636819827475\%5D,\%5B3.7902832031250004,7.612997502224103\%5D,\%5B3.2080078125,7.612997502224103\%5D,\%5B3.2080078125,7.0027636819827475\%5D\%5D\%5D\%7D\%7D\%5D\%7D}{https://api.worldpop.org/v1/wopr/polyagesex?iso3=NGA\&ver=1.2\&agesex=m0,m1,f0,f1\&geojson=\{``type'':``FeatureCollection'',``features'':{[}\{``type'':``Feature'',``properties'':\{\},``geometry'':\{``type'':``Polygon'',``coordinates'':{[}{[}{[}3.2080078125,7.0027636819827475{]},{[}3.7902832031250004,7.0027636819827475{]},{[}3.7902832031250004,7.612997502224103{]},{[}3.2080078125,7.612997502224103{]},{[}3.2080078125,7.0027636819827475{]}{]}{]}\}\}{]}\}}

This request returns a task identification number
\texttt{b6418707-d795-56ef-9d06-c469e3697782} that can be used to query
the result:\\
\url{https://api.worldpop.org/v1/tasks/b6418707-d795-56ef-9d06-c469e3697782}\\

\end{document}
